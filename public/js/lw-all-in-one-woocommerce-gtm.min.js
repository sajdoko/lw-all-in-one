function lwaio_map_ec_to_ga4(e){if(!e)return;const t=(e.category?e.category:"").toString().split("/");let o={item_id:e.id?e.id:"",item_name:e.name?e.name:"",item_brand:e.brand?e.brand:"",price:e.price?e.price:""};if(1==t.length)o.item_category=t[0];else if(t.length>1){o.item_category=t[0];for(let e=1;e<Math.min(5,t.length);e++)o["item_category"+(e+1)]=t[e]}return e.variant&&(o.item_variant=e.variant),e.list&&(o.item_list_name=e.list),e.position&&(o.index=e.position),e.quantity&&(o.quantity=e.quantity),e.coupon&&(o.coupon=e.coupon),o}function lwaio_handle_cart_qty_change(){document.querySelectorAll(".product-quantity input.qty").forEach(function(e){const t=e.defaultValue;let o=parseInt(e.value);if(isNaN(o)&&(o=t),t!=o){const a=e.closest(".cart_item"),i=a&&a.querySelector(".remove");if(!i)return;let c=i.getAttribute("data-lwaio_product_price");if("string"==typeof c?(c=parseFloat(c),isNaN(c)&&(c=0)):"number"!=typeof c&&(c=0),t<o){const e={name:i.getAttribute("data-lwaio_product_name"),id:i.getAttribute("data-lwaio_product_id"),price:c.toFixed(2),category:i.getAttribute("data-lwaio_product_cat"),variant:i.getAttribute("data-lwaio_product_variant"),stocklevel:i.getAttribute("data-lwaio_product_stocklevel"),brand:i.getAttribute("data-lwaio_product_brand"),quantity:o-t};window.dataLayer.push({event:"lwaio.addProductToCart",ecommerce:{currencyCode:lwaio_currency,add:{products:[e]}}}),window.dataLayer.push({event:"add_to_cart",ecommerce:{currency:lwaio_currency,value:c.toFixed(2)*(o-t),items:[lwaio_map_ec_to_ga4(e)]}})}else{const e={name:i.getAttribute("data-lwaio_product_name"),id:i.getAttribute("data-lwaio_product_id"),price:c.toFixed(2),category:i.getAttribute("data-lwaio_product_cat"),variant:i.getAttribute("data-lwaio_product_variant"),stocklevel:i.getAttribute("data-lwaio_product_stocklevel"),brand:i.getAttribute("data-lwaio_product_brand"),quantity:t-o};window.dataLayer.push({event:"lwaio.removeFromCart",ecommerce:{currencyCode:lwaio_currency,remove:{products:[e]}}}),window.dataLayer.push({event:"remove_from_cart",ecommerce:{currency:lwaio_currency,value:c.toFixed(2)*(t-o),items:[lwaio_map_ec_to_ga4(e)]}})}}})}function lwaio_handle_payment_method_change(){if(lwaio_checkout_step_fired.indexOf("payment_method")>-1)return;if("complete"!=document.readyState)return;let e="(payment type not found)",t=document.querySelector(".payment_methods input:checked");t||(t=document.querySelector("input[name^=payment_method]")),t&&(e=t.value),window.dataLayer.push({event:"lwaio.checkoutStep",ecommerce:{currencyCode:lwaio_currency,checkout:{actionField:{step:4+window.lwaio_checkout_step_offset+lwaio_shipping_payment_method_step_offset},products:window.lwaio_checkout_products}}}),window.dataLayer.push({event:"add_payment_info",ecommerce:{currency:lwaio_currency,payment_type:e,value:window.lwaio_checkout_value,items:window.lwaio_checkout_products_ga4}}),lwaio_checkout_step_fired.push("payment_method")}function lwaio_handle_shipping_method_change(){if(lwaio_checkout_step_fired.indexOf("shipping_method")>-1)return;if("complete"!=document.readyState)return;let e="(shipping tier not found)",t=document.querySelector("input[name^=shipping_method]:checked");t||(t=document.querySelector("input[name^=shipping_method]")),t&&(e=t.value),window.dataLayer.push({event:"lwaio.checkoutStep",ecommerce:{currencyCode:lwaio_currency,checkout:{actionField:{step:3+window.lwaio_checkout_step_offset+lwaio_shipping_payment_method_step_offset},products:window.lwaio_checkout_products}}}),window.dataLayer.push({event:"add_shipping_info",ecommerce:{currency:lwaio_currency,shipping_tier:e,value:window.lwaio_checkout_value,items:window.lwaio_checkout_products_ga4}}),lwaio_checkout_step_fired.push("shipping_method")}function lwaio_process_woocommerce_pages(){window.lwaio_is_cart=!1,window.lwaio_is_checkout=!1;const e=document.querySelector("body");e&&(window.lwaio_is_cart=e.classList&&e.classList.contains("woocommerce-cart"),window.lwaio_is_checkout=e.classList&&e.classList.contains("woocommerce-checkout"));const t={"wp-block-handpicked-products":{displayname:"Handpicked Products",counter:1},"wp-block-product-best-sellers":{displayname:"Best Selling Products",counter:1},"wp-block-product-category":{displayname:"Product Category List",counter:1},"wp-block-product-new":{displayname:"New Products",counter:1},"wp-block-product-on-sale":{displayname:"Sale Products",counter:1},"wp-block-products-by-attribute":{displayname:"Products By Attribute",counter:1},"wp-block-product-tag":{displayname:"Products By Tag",counter:1},"wp-block-product-top-rated":{displayname:"Top Rated Products",counter:1}};if(document.querySelectorAll(".wc-block-grid .wc-block-grid__product").forEach(function(e){const o=e.closest(".wc-block-grid"),a=e.querySelector(".lwaio_productdata");if(o&&a){const e=o.classList;if(e)for(let o in t)e.contains(o)&&(a.setAttribute("data-lwaio_productlist_name",t[o].displayname),a.setAttribute("data-lwaio_product_listposition",t[o].counter),t[o].counter++)}}),document.querySelectorAll(".lwaio_productdata,.widget-product-item").length>0){let e,t=[],a=[],i=0;document.querySelectorAll(".lwaio_productdata,.widget-product-item").forEach(function(o){"string"==typeof(i=o.getAttribute("data-lwaio_product_price"))?(i=parseFloat(i),isNaN(i)&&(i=0)):"number"!=typeof i&&(i=0),e={name:o.getAttribute("data-lwaio_product_name"),id:o.getAttribute("data-lwaio_product_id"),price:i.toFixed(2),category:o.getAttribute("data-lwaio_product_cat"),position:o.getAttribute("data-lwaio_product_listposition"),list:o.getAttribute("data-lwaio_productlist_name"),stocklevel:o.getAttribute("data-lwaio_product_stocklevel"),brand:o.getAttribute("data-lwaio_product_brand")},t.push(e),a.push(lwaio_map_ec_to_ga4(e))});for(var o=0;o<window.dataLayer.length;o++)if(window.dataLayer[o].ecommerce){window.dataLayer[o].ecommerce.impressions?window.dataLayer[o].ecommerce.impressions=window.dataLayer[o].ecommerce.impressions.concat(t):window.dataLayer[o].ecommerce.impressions=t;break}o==window.dataLayer.length&&(o=0,window.dataLayer[o].ecommerce={},window.dataLayer[o].ecommerce.impressions=t),window.dataLayer[o].ecommerce.currencyCode=lwaio_currency}document.addEventListener("click",function(e){let t=e.target;if(!t)return!0;try{if(!t.closest(".add_to_cart_button:not(.product_type_variable, .product_type_grouped, .single_add_to_cart_button)"))return!0}catch(e){return!0}const o=t.closest(".product,.wc-block-grid__product"),a=o&&o.querySelector(".lwaio_productdata");if(!a)return!0;let i=a.getAttribute("data-lwaio_product_price");"string"==typeof i?(i=parseFloat(i),isNaN(i)&&(i=0)):"number"!=typeof i&&(i=0);const c={name:a.getAttribute("data-lwaio_product_name"),id:a.getAttribute("data-lwaio_product_id"),price:i.toFixed(2),category:a.getAttribute("data-lwaio_product_cat"),stocklevel:a.getAttribute("data-lwaio_product_stocklevel"),brand:a.getAttribute("data-lwaio_product_brand"),quantity:1};window.dataLayer.push({event:"lwaio.addProductToCart",ecommerce:{currencyCode:lwaio_currency,add:{products:[c]}}}),window.dataLayer.push({event:"add_to_cart",ecommerce:{currency:lwaio_currency,value:i.toFixed(2),items:[lwaio_map_ec_to_ga4(c)]}})}),document.addEventListener("click",function(e){let t=e.target;if(!t)return!0;try{if(!t.closest(".single_add_to_cart_button:not(.disabled)"))return!0}catch(e){return!0}const o=t.closest("form.cart");if(!o)return!0;let a=o.querySelectorAll("[name=variation_id]"),i=o.classList&&o.classList.contains("grouped_form");if(a.length>0){if(lwaio_last_selected_product_variation){const e=o.querySelector("[name=quantity]");lwaio_last_selected_product_variation.quantity=e&&e.value||1,window.dataLayer.push({event:"lwaio.addProductToCart",ecommerce:{currencyCode:lwaio_currency,add:{products:[lwaio_last_selected_product_variation]}}}),window.dataLayer.push({event:"add_to_cart",ecommerce:{currency:lwaio_currency,value:lwaio_last_selected_product_variation.price*lwaio_last_selected_product_variation.quantity,items:[lwaio_map_ec_to_ga4(lwaio_last_selected_product_variation)]}})}}else if(i){const e=document.querySelectorAll(".grouped_form .lwaio_productdata");let t=[],o=[],a=0;if(e.forEach(function(e){const i=document.querySelectorAll("input[name=quantity\\["+e.getAttribute("data-lwaio_product_internal_id")+"\\]]");if(!(i.length>0))return!0;if(product_qty=i[0]&&i[0].value||1,0==product_qty)return!0;const c={id:lwaio_use_sku_instead?e.getAttribute("data-lwaio_product_sku"):e.getAttribute("data-lwaio_product_id"),name:e.getAttribute("data-lwaio_product_name"),price:e.getAttribute("data-lwaio_product_price"),category:e.getAttribute("data-lwaio_product_cat"),quantity:product_qty,stocklevel:e.getAttribute("data-lwaio_product_stocklevel"),brand:e.getAttribute("data-lwaio_product_brand")};t.push(c),o.push(lwaio_map_ec_to_ga4(c)),a+=c.price*c.quantity}),0==t.length)return!0;window.dataLayer.push({event:"lwaio.addProductToCart",ecommerce:{currencyCode:lwaio_currency,add:{products:t}}}),window.dataLayer.push({event:"add_to_cart",ecommerce:{currency:lwaio_currency,value:a,items:o}})}else{const e=lwaio_use_sku_instead?o.querySelector("[name=lwaio_sku]"):o.querySelector("[name=lwaio_id]"),t={id:e&&e.value,name:o.querySelector("[name=lwaio_name]")&&o.querySelector("[name=lwaio_name]").value,price:o.querySelector("[name=lwaio_price]")&&o.querySelector("[name=lwaio_price]").value,category:o.querySelector("[name=lwaio_category]")&&o.querySelector("[name=lwaio_category]").value,quantity:o.querySelector("[name=quantity]")&&o.querySelector("[name=quantity]").value,stocklevel:o.querySelector("[name=lwaio_stocklevel]")&&o.querySelector("[name=lwaio_stocklevel]").value,brand:o.querySelector("[name=lwaio_brand]")&&o.querySelector("[name=lwaio_brand]").value};window.dataLayer.push({event:"lwaio.addProductToCart",ecommerce:{currencyCode:lwaio_currency,add:{products:[t]}}}),window.dataLayer.push({event:"add_to_cart",ecommerce:{currency:lwaio_currency,value:t.price*t.quantity,items:[lwaio_map_ec_to_ga4(t)]}})}}),document.addEventListener("click",function(e){let t=e.target;if(!(t=t&&t.closest(".mini_cart_item a.remove,.product-remove a.remove")))return!0;let o=0;const a=t.closest(".cart_item");let i=a&&a.querySelectorAll(".product-quantity input.qty");if(i&&0!==i.length)o=i[0].value;else{const e=t.closest(".mini_cart_item");(i=e&&e.querySelectorAll(".quantity"))&&i.length>0&&(o=parseInt(i[0].textContent),Number.isNaN(o)&&(o=0))}if(0===o)return!0;const c={name:t.getAttribute("data-lwaio_product_name"),id:t.getAttribute("data-lwaio_product_id"),price:t.getAttribute("data-lwaio_product_price"),category:t.getAttribute("data-lwaio_product_cat"),variant:t.getAttribute("data-lwaio_product_variant"),stocklevel:t.getAttribute("data-lwaio_product_stocklevel"),brand:t.getAttribute("data-lwaio_product_brand"),quantity:o};window.dataLayer.push({event:"lwaio.removeFromCart",ecommerce:{currencyCode:lwaio_currency,remove:{products:[c]}}}),window.dataLayer.push({event:"remove_from_cart",ecommerce:{currency:lwaio_currency,value:c.price*c.quantity,items:[lwaio_map_ec_to_ga4(c)]}})});if(document.addEventListener("click",function(e){if("undefined"==typeof google_tag_manager)return!0;const t=e.target,o=t.closest(".products li:not(.product-category) a:not(.add_to_cart_button):not(.quick-view-button),.wc-block-grid__products li:not(.product-category) a:not(.add_to_cart_button):not(.quick-view-button),.products>div:not(.product-category) a:not(.add_to_cart_button):not(.quick-view-button),.widget-product-item,.woocommerce-grouped-product-list-item__label a");if(!o)return!0;let a,i=t.closest(".product,.wc-block-grid__product");if(i?a=i.querySelector(".lwaio_productdata"):(i=t.closest(".products li"))?a=i.querySelector(".lwaio_productdata"):(i=t.closest(".products>div"))?a=i.querySelector(".lwaio_productdata"):(i=t.closest(".woocommerce-grouped-product-list-item__label"),a=i?i.querySelector(".lwaio_productdata"):t),void 0===a.getAttribute("data-lwaio_product_id")||""==a.getAttribute("data-lwaio_product_id"))return!0;if(a.getAttribute("data-lwaio_product_url")!=o.getAttribute("href"))return!0;const c={id:a.getAttribute("data-lwaio_product_id"),name:a.getAttribute("data-lwaio_product_name"),price:a.getAttribute("data-lwaio_product_price"),category:a.getAttribute("data-lwaio_product_cat"),stocklevel:a.getAttribute("data-lwaio_product_stocklevel"),brand:a.getAttribute("data-lwaio_product_brand"),position:a.getAttribute("data-lwaio_product_listposition")};for(let e in window.google_tag_manager)if("gtm-"==e.substring(0,4).toLowerCase()){window.lwaio_first_container_id=e;break}if(""===window.lwaio_first_container_id)return!0;const r=e.ctrlKey||e.metaKey,n="_blank"===o.target;e.preventDefault(),(r||n)&&(window.productpage_window=window.open("about:blank","_blank")),window.dataLayer.push({event:"lwaio.productClick",ecommerce:{currencyCode:lwaio_currency,click:{actionField:{list:a.getAttribute("data-lwaio_productlist_name")},products:[c]}},eventCallback:function(e){if(void 0!==e&&window.lwaio_first_container_id!=e)return!0;window.dataLayer.push({event:"select_item",ecommerce:{currency:lwaio_currency,items:[lwaio_map_ec_to_ga4(c)]},eventCallback:function(e){if(void 0!==e&&window.lwaio_first_container_id!=e)return!0;(n||r)&&productpage_window?productpage_window.location.href=a.getAttribute("data-lwaio_product_url"):document.location.href=a.getAttribute("data-lwaio_product_url")},eventTimeout:2e3})},eventTimeout:2e3})}),jQuery(document).on("found_variation",function(e,t){if(void 0===t)return;if("interactive"===document.readyState&&lwaio_changedetail_fired_during_pageload)return;const o=e.target,a=(o.querySelector("[name=variation_id]")&&o.querySelector("[name=variation_id]").value,o.querySelector("[name=lwaio_id]")&&o.querySelector("[name=lwaio_id]").value,o.querySelector("[name=lwaio_name]")&&o.querySelector("[name=lwaio_name]").value),i=(o.querySelector("[name=lwaio_sku]")&&o.querySelector("[name=lwaio_sku]").value,o.querySelector("[name=lwaio_category]")&&o.querySelector("[name=lwaio_category]").value);o.querySelector("[name=lwaio_price]")&&o.querySelector("[name=lwaio_price]").value;let c={name:a,id:0,price:0,category:i,stocklevel:o.querySelector("[name=lwaio_stocklevel]")&&o.querySelector("[name=lwaio_stocklevel]").value,brand:o.querySelector("[name=lwaio_brand]")&&o.querySelector("[name=lwaio_brand]").value,variant:""};c.id=t.variation_id,lwaio_use_sku_instead&&t.sku&&""!==t.sku&&(c.id=t.sku),c.price=t.display_price;let r=[];for(let e in t.attributes)r.push(t.attributes[e]);c.variant=r.join(","),lwaio_last_selected_product_variation=c,window.dataLayer.push({event:"lwaio.changeDetailView",ecommerce:{currencyCode:lwaio_currency,detail:{products:[c]}},ecomm_prodid:lwaio_id_prefix+c.id,ecomm_pagetype:"product",ecomm_totalvalue:c.price}),window.dataLayer.push({event:"view_item",ecommerce:{currency:lwaio_currency,value:c.price,items:[lwaio_map_ec_to_ga4(c)]}}),"interactive"===document.readyState&&(lwaio_changedetail_fired_during_pageload=!0)}),jQuery(".variations select").trigger("change"),jQuery(document).ajaxSuccess(function(e,t,o){void 0!==o&&o.url.indexOf("wc-api=WC_Quick_View")>-1&&setTimeout(function(){const e=document.querySelector("#lwaio_quickview_data");if(e&&e.dataset&&e.dataset.lwaio_datalayer)try{const t=JSON.parse(e.dataset.lwaio_datalayer);t&&window.dataLayer&&window.dataLayer.push(t)}catch(e){console&&console.error&&console.error(e.message)}},500)}),lwaio_is_cart&&(document.addEventListener("click",function(e){let t=e.target;return!t||(!t.closest("[name=update_cart]")||void lwaio_handle_cart_qty_change())}),document.addEventListener("keypress",function(e){let t=e.target;return!t||(!t.closest(".woocommerce-cart-form input[type=number]")||void lwaio_handle_cart_qty_change())})),lwaio_is_checkout&&(window.lwaio_checkout_step_offset=window.lwaio_checkout_step_offset||0,window.lwaio_checkout_value=window.lwaio_checkout_value||0,window.lwaio_checkout_products=window.lwaio_checkout_products||[],window.lwaio_checkout_products_ga4=window.lwaio_checkout_products_ga4||[],document.addEventListener("focusout",function(e){let t=e.target;return!t||(!t.closest||!t.closest("input[name^=shipping_]:not(input[name^=shipping_method])")||void(lwaio_checkout_step_fired.indexOf("shipping")>-1||""!=t.value.trim()&&(window.dataLayer.push({event:"lwaio.checkoutStep",ecommerce:{currencyCode:lwaio_currency,checkout:{actionField:{step:2+window.lwaio_checkout_step_offset},products:window.lwaio_checkout_products}}}),lwaio_checkout_step_fired.push("shipping"))))}),document.addEventListener("change",function(e){let t=e.target;return!t||(!t.closest("input[name^=shipping_method]")||void lwaio_handle_shipping_method_change())}),document.addEventListener("change",function(e){let t=e.target;return!t||(!t.closest("input[name=payment_method]")||void lwaio_handle_payment_method_change())}),document.addEventListener("submit",function(e){let t=e.target;if(!t)return!0;if(!t.closest("form[name=checkout]"))return!0;-1==lwaio_checkout_step_fired.indexOf("shipping_method")&&lwaio_handle_shipping_method_change(),-1==lwaio_checkout_step_fired.indexOf("payment_method")&&lwaio_handle_payment_method_change();let o=document.querySelector("input[name^=shipping_method]:checked");o||(o=document.querySelector("input[name^=shipping_method]")),o&&window.dataLayer.push({event:"lwaio.checkoutOption",ecommerce:{checkout_option:{actionField:{step:3+window.lwaio_checkout_step_offset+lwaio_shipping_payment_method_step_offset,option:"Shipping: "+o.value}}}});let a=document.querySelector(".payment_methods input:checked");a||(a=document.querySelector("input[name^=payment_method]")),a&&window.dataLayer.push({event:"lwaio.checkoutOption",ecommerce:{checkout_option:{actionField:{step:4+window.lwaio_checkout_step_offset+lwaio_shipping_payment_method_step_offset,option:"Payment: "+a.value}}}})})),window.lwaio_remarketing&&!lwaio_is_cart&&!lwaio_is_checkout&&jQuery(".lwaio_productdata").length>0){for(o=0;o<window.dataLayer.length&&!window.dataLayer[o].ecomm_prodid;o++);var a;if(o==window.dataLayer.length&&(o=0,window.dataLayer[o].ecomm_prodid=[]),void 0!==window.dataLayer[o].ecomm_prodid.push)jQuery(".lwaio_productdata").each(function(){a=jQuery(this),window.dataLayer[o].ecomm_prodid.push(lwaio_id_prefix+a.data("lwaio_product_id"))})}window.dataLayer&&window.dataLayer.forEach&&window.dataLayer.forEach(function(e){if(e&&e.ecommerce&&e.ecommerce.detail&&window.dataLayer.push({event:"view_item",ecommerce:{currency:lwaio_currency,value:e.ecommerce.detail.products[0].price,items:[lwaio_map_ec_to_ga4(e.ecommerce.detail.products[0])]}}),e&&e.ecommerce&&(e.ecommerce.cart||e.ecommerce.checkout&&lwaio_is_cart)){let t=e.ecommerce.cart||e.ecommerce.checkout.products,o=[],a=0;t.forEach(function(e){o.push(lwaio_map_ec_to_ga4(e)),a+=e.price*e.quantity}),window.dataLayer.push({event:"view_cart",ecommerce:{currency:lwaio_currency,value:a.toFixed(2),items:o}})}if(e&&e.ecommerce&&e.ecommerce.checkout&&!lwaio_is_cart){let t=[],o=0;e.ecommerce.checkout.products.forEach(function(e){t.push(lwaio_map_ec_to_ga4(e)),o+=e.price*e.quantity}),window.dataLayer.push({event:"begin_checkout",ecommerce:{currency:lwaio_currency,value:o,items:t}})}if(e&&e.ecommerce&&e.ecommerce.add){let t=[],o=0;e.ecommerce.add.products.forEach(function(e){t.push(lwaio_map_ec_to_ga4(e)),o+=e.price*e.quantity}),window.dataLayer.push({event:"add_to_cart",ecommerce:{currency:lwaio_currency,value:o,items:t}})}if(e&&e.ecommerce&&e.ecommerce.purchase){let t=[];e.ecommerce.purchase.products.forEach(function(e){t.push(lwaio_map_ec_to_ga4(e))}),window.dataLayer.push({event:"purchase",ecommerce:{currency:lwaio_currency,items:t,transaction_id:e.ecommerce.purchase.actionField.id,affiliation:e.ecommerce.purchase.actionField.affiliation,value:e.ecommerce.purchase.actionField.revenue,tax:e.ecommerce.purchase.actionField.tax,shipping:e.ecommerce.purchase.actionField.shipping,coupon:e.ecommerce.purchase.actionField.coupon}})}})}function lwaio_page_loading_completed(){document.removeEventListener("DOMContentLoaded",lwaio_page_loading_completed),window.removeEventListener("load",lwaio_page_loading_completed),lwaio_process_woocommerce_pages()}window.lwaio_last_selected_product_variation,window.lwaio_changedetail_fired_during_pageload=!1,window.lwaio_is_cart=!1,window.lwaio_is_checkout=!1,window.lwaio_checkout_step_fired=[],window.lwaio_shipping_payment_method_step_offset=-1,window.lwaio_first_container_id="","loading"!==document.readyState?window.setTimeout(lwaio_process_woocommerce_pages):(document.addEventListener("DOMContentLoaded",lwaio_page_loading_completed),window.addEventListener("load",lwaio_page_loading_completed));